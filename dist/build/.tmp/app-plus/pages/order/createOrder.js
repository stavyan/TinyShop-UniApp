(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{"1d91":function(t,e,n){"use strict";n.r(e);var i=n("4784"),r=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=r.a},"45d6":function(t,e,n){},4784:function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=s(n("a34a")),o=n("c4c8"),a=s(n("c1df"));function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t,e,n,i,r,o,a){try{var s=t[o](a),u=s.value}catch(c){return void n(c)}s.done?e(u):Promise.resolve(u).then(i,r)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function a(t){h(o,i,r,a,s,"next",t)}function s(t){h(o,i,r,a,s,"throw",t)}a(void 0)}))}}var l=function(){return n.e("components/empty").then(n.bind(null,"d138"))},f=function(){return n.e("components/mpvue-picker/mpvuePicker").then(n.bind(null,"13f1"))},m={components:{mpvuePicker:f,empty:l},data:function(){return{maskState:0,desc:"",payType:1,orderDetail:{},pointExchangeType:[],loadingType:"more",pickerShippingType:[{label:"物流配送",value:1},{label:"买家自提",value:2}],currentShippingType:{},currentCompany:{},currentPickupPoint:{},cartIds:null,invoiceItem:{},addressData:{},couponItem:{},pointConfig:{},product:null,shippingMoney:0,isUsePoint:!1,isUsePointDisabled:!1,data:{},userInfo:{},use_point:0,invoiceContent:null}},computed:{amountGoods:function(){var t=0;return this.orderDetail.products&&this.orderDetail.products.forEach((function(e){t+=parseInt(e.num,10)*parseFloat(e.price)})),this.floor(t)},discountAmount:function(){var t=this.floor((100-this.couponItem.discount)/100*this.amountGoods);return 2===parseInt(this.couponItem.type,10)?t:this.couponItem.money||0},realAmount:function(){var t=this.amountGoods-this.discountAmount+parseFloat(this.shippingMoney)-(this.isUsePoint?this.maxUsePointFee:0);return(this.floor(parseFloat(this.invoiceAmount)+t)||0).toFixed(2)},invoiceAmount:function(){var t=this.amountGoods-this.discountAmount-(this.isUsePoint?this.maxUsePointFee:0);return this.invoiceItem.type?this.floor(this.orderDetail.invoice.order_invoice_tax/100*t):0},maxUsePoint:function(){return this.orderDetail.max_use_point>t.getStorageSync("userInfo").account.user_integral?t.getStorageSync("userInfo").account.user_integral:this.orderDetail.max_use_point},maxUsePointFee:function(){return this.maxUsePoint*this.pointConfig.convert_rate}},filters:{time:function(t){return(0,a.default)(1e3*t).format("YY/MM/DD HH:mm")}},onShow:function(){this.addressData&&this.addressData.realname&&this.getOrderFreightFee()},onLoad:function(t){this.initData(t)},methods:{handleInvoiceChange:function(t){this.invoiceContent=t},navTo:function(e){t.navigateTo({url:e})},closeInvoice:function(){this.invoiceItem={}},floor:function(t){return Math.floor(100*t)/100},handleIsUsePoint:function(){this.isUsePoint?(this.isUsePoint=!1,this.use_point=0):(this.isUsePoint=!0,this.use_point=this.maxUsePoint)},showSinglePicker:function(){this.$refs.shippingTypePicker.show()},showCompanyPicker:function(){this.$refs.companyTypePicker.show()},showPickupPointPicker:function(){this.$refs.pickupPointPicker.show()},onConfirm:function(t){t.value=t.value[0],this.currentShippingType=t,2==this.currentShippingType.value?parseFloat(this.realAmount)>parseFloat(this.orderDetail.pickup_point_config.pickup_point_freight)?this.shippingMoney=0:this.shippingMoney=parseFloat(this.orderDetail.pickup_point_config.pickup_point_fee)||0:(this.currentCompany=this.orderDetail.company[0],this.getOrderFreightFee())},onCompanyConfirm:function(){var t=d(r.default.mark((function t(e){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.value=e.value[0],this.currentCompany=e,!this.orderDetail.is_full_mail){t.next=5;break}return this.shippingMoney=0,t.abrupt("return");case 5:this.getOrderFreightFee();case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onPickupPointConfirm:function(){var t=d(r.default.mark((function t(e){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.value=e.value[0],this.currentPickupPoint=e,!this.currentPickupPoint){t.next=5;break}return this.shippingMoney=parseFloat(this.orderDetail.pickup_point_config.pickup_point_fee)||0,t.abrupt("return");case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getOrderFreightFee:function(){var e=d(r.default.mark((function e(){var n,a=this;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.showLoading({title:"加载中..."}),n={},this.addressData&&(n.address_id=this.addressData.id),this.currentCompany&&(n.company_id=this.currentCompany.value),e.next=6,this.$get("".concat(o.orderFreightFee),c({},n,{},this.data)).then((function(t){a.shippingMoney=t.data.shipping_money||0})).catch((function(t){console.log(i(t," at pages/order/createOrder.vue:420"))}));case 6:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}(),initData:function(){var e=d(r.default.mark((function e(n){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,JSON.parse(n.data);case 2:return this.data=e.sent,this.userInfo=t.getStorageSync("userInfo"),e.next=6,this.getOrderDetail(this.data);case 6:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}(),getOrderDetail:function(){var e=d(r.default.mark((function e(n){var a=this;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$get("".concat(o.orderPreview),c({},n)).then((function(e){200===e.code?(a.orderDetail=e.data,a.pointConfig=a.orderDetail.point_config,a.addressData=a.orderDetail.address,a.currentShippingType=a.pickerShippingType[0],a.orderDetail.company.forEach((function(t){t.label=t.title,t.value=t.id})),a.currentCompany=a.orderDetail.company[0],a.pointExchangeType=[],a.orderDetail.products.forEach((function(t){a.pointExchangeType.push(t.point_exchange_type)})),1===parseInt(a.orderDetail.pickup_point_config.buyer_self_lifting,10)?(a.orderDetail.pickup_point_config.list.forEach((function(t){t.label="".concat(t.contact||"无名"," - ").concat(t.name||"未知"," - ").concat(t.address||"未知"),t.value=t.id})),a.currentPickupPoint=a.orderDetail.pickup_point_config.list[0]||{},1!==parseInt(a.orderDetail.pickup_point_config.pickup_point_is_open,10)&&(a.shippingMoney=0)):a.orderDetail.pickup_point_config.list=[]):t.showToast({title:e.message,icon:"none"})})).catch((function(t){console.log(i(t," at pages/order/createOrder.vue:469"))}));case 2:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}(),toggleMask:function(t){var e=this,n="show"===t?10:300,i="show"===t?1:0;this.maskState=2,setTimeout((function(){e.maskState=i}),n)},numberChange:function(t){this.number=t.number},changePayType:function(t){this.payType=t},submit:function(){var e=d(r.default.mark((function e(){var n;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.showLoading({title:"加载中..."}),n={},!this.addressData||!this.addressData.id){e.next=6;break}n.address_id=this.addressData.id,e.next=8;break;case 6:return t.showToast({title:"请选择收货地址",icon:"none"}),e.abrupt("return");case 8:return this.couponItem&&this.couponItem.id&&(n.coupon_id=this.couponItem.id),this.invoiceItem&&this.invoiceItem.id&&(n.invoice_id=this.invoiceItem.id,n.invoice_content=this.invoiceContent||this.orderDetail.invoice.list[0]),this.currentCompany&&this.currentCompany.value&&(n.company_id=this.currentCompany.value),this.currentPickupPoint&&this.currentPickupPoint.value&&(n.pickup_id=this.currentPickupPoint.value),this.currentShippingType&&this.currentShippingType.value&&(n.shipping_type=this.currentShippingType.value),this.use_point&&(n.use_point=this.use_point),e.next=16,this.$post("".concat(o.orderCreate),c({},n,{},this.data)).then((function(e){if(200===e.code){var n={};n.order_id=parseInt(e.data.id,10),1===parseInt(e.data.pay_status,10)?t.redirectTo({url:"/pages/money/paySuccess"}):t.redirectTo({url:"/pages/money/pay?id=".concat(e.data.id)})}else t.showToast({title:e.message,icon:"none"})})).catch((function(t){console.log(i(t," at pages/order/createOrder.vue:540"))}));case 16:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}(),stopPrevent:function(){},selectCoupon:function(e){this.amountGoods<e.at_least?t.showToast({title:"不满足优惠券使用条件~",icon:"none"}):(this.maskState=0,this.couponItem=e)}}};e.default=m}).call(this,n("6e42")["default"],n("0de9")["default"])},6153:function(t,e,n){"use strict";(function(t){n("6cdc"),n("921b");i(n("66fd"));var e=i(n("d180"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},ade5:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=(t._self._c,parseInt(t.orderDetail.is_logistics,10)),i=parseInt(t.currentShippingType.value,10),r=parseInt(t.currentShippingType.value,10),o=parseInt(t.pointConfig.is_open),a=parseInt(t.invoiceItem.type,10),s=t.__map(t.orderDetail.coupons,(function(e,n){var i=t._f("time")(e.start_time),r=t._f("time")(e.end_time),o=parseInt(e.couponType.type,10),a=parseInt(e.range_type,10),s=parseInt(e.term_of_validity_type,10);return{$orig:t.__get_orig(e),f0:i,f1:r,m5:o,m6:a,m7:s}}));t.$mp.data=Object.assign({},{$root:{m0:n,m1:i,m2:r,m3:o,m4:a,l0:s}})},r=[];n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}))},b618:function(t,e,n){"use strict";var i=n("45d6"),r=n.n(i);r.a},d180:function(t,e,n){"use strict";n.r(e);var i=n("ade5"),r=n("1d91");for(var o in r)"default"!==o&&function(t){n.d(e,t,(function(){return r[t]}))}(o);n("b618");var a=n("2877"),s=Object(a["a"])(r["default"],i["a"],i["b"],!1,null,null,null);e["default"]=s.exports}},[["6153","common/runtime","common/vendor"]]]);